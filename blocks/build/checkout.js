(()=>{"use strict";const e=window.React,t=window.wp.htmlEntities,n=window.wp.element,c=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,r=()=>{var e;return"kco"===(null===(e=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked'))||void 0===e?void 0:e.value)},a=window.wc.blocksCheckout;var i=function(e,t,n,c){return new(n||(n=Promise))(function(o,r){function a(e){try{l(c.next(e))}catch(e){r(e)}}function i(e){try{l(c.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}l((c=c.apply(e,t||[])).next())})};const l=(0,o.getSetting)("kco_data",{}),s=(0,t.decodeEntities)(l.title||"Kustom Checkout"),u=(0,t.decodeEntities)(l.description||""),d=(0,t.decodeEntities)(l.iconUrl||""),p=l.features||[],m=t=>{const{activePaymentMethod:c,billing:o,cartData:s}=t,{isActive:d,suspendKCO:p,resumeKCO:m}=((e,t)=>{const[c,o]=(0,n.useState)(r()||"kco"===t),[l,s]=(0,n.useState)(null),[u,d]=(0,n.useState)(null),{snippet:p,shippingInIframe:m,countryCodes:h}=e,k=(e=>["#shipping-fields","#billing-fields","#contact-fields",".wc-block-components-checkout-place-order-button",".wp-block-woocommerce-checkout-terms-block",e?"#shipping-option":""])(m),w=(0,n.useRef)(),f=(0,n.useRef)(null),b=(0,n.useRef)(null),_=(0,n.useCallback)(()=>{const e=p.match(/<script.*?>([\s\S]*?)<\/script>/),t=e?e[1]:"";return{htmlContentText:p.replace(/<script.*<\/script>/,""),scriptContentText:t}},[p]),C=(0,n.useCallback)((e=!0)=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(t){t.suspend({autoResume:e})})},[]),y=(0,n.useCallback)(()=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.resume()})},[]),g=(0,n.useCallback)(e=>Object.keys(h).find(t=>h[t]===e.toUpperCase())||"",[h]),v=(0,n.useCallback)(e=>i(void 0,void 0,void 0,function*(){C();const t=g(e.country);return e.country=t,(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_address_changed"},e)}).then(()=>{}).catch(e=>{}).finally(()=>{})}),[g,C]),E=(0,n.useCallback)(e=>i(void 0,void 0,void 0,function*(){return C(),(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_option_changed"},e)}).then(e=>{}).catch(e=>{}).finally(()=>{y()})}),[C,y]);(0,n.useEffect)(()=>{const{htmlContentText:e,scriptContentText:t}=_();s(e),d(t)},[p,_]);const x=(0,n.useCallback)(()=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({load:e=>{},shipping_address_change:v,shipping_option_change:E,change:e=>{},user_interacted:e=>{},customer:e=>{},billing_address_change:e=>{},shipping_address_update_error:e=>{},order_total_change:e=>{},checkbox_change:e=>{},can_not_complete_order:e=>{},network_error:e=>{},load_confirmation:e=>{},redirect_initiated:e=>{}})})},[v,E]);return(0,n.useEffect)(()=>(c&&l&&!w.current&&(k.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: none;")}),f.current=(e=>{const t=document.createElement("div");t.id="kco-wrapper",t.className="wc-block-checkout__klarna-checkout wc-block-components-klarna-checkout-block",t.innerHTML=e;const n=document.querySelector(".wc-block-checkout__payment-method");return n&&n.after(t),t})(l),b.current=document.createElement("script"),b.current.textContent=u,document.body.appendChild(b.current),w.current=c),x(),()=>{r()||(f.current&&f.current.remove(),k.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: block;")}),document.body.removeChild(b.current),f.current=null,b.current=null,w.current=c)}),[c,l,u,k,x]),{isActive:c,elementsToHide:k,suspendKCO:C,resumeKCO:y}})(l,c);return(0,n.useEffect)(()=>{d&&(p(),m())},[o.cartTotalItems,d,m,p]),""===u?null:e.createElement("div",{className:"wc-block-components-klarna-checkout"},e.createElement("p",null,u))},h={name:"kco",label:e.createElement(()=>e.createElement("div",{style:{display:"flex",gap:16,width:"100%",justifyContent:"space-between",paddingRight:16}},e.createElement("span",null,s),e.createElement("img",{src:d,alt:s})),null),content:e.createElement(m,null),edit:e.createElement(m,null),placeOrderButtonLabel:"Pay with Kustom Checkout",canMakePayment:()=>(!l.error&&l.snippet||console.error("Failed to initialize Kustom Checkout: "+l.error),!0),ariaLabel:s,supports:{features:p}};(0,c.registerPaymentMethod)(h)})();