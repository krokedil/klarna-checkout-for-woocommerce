(()=>{"use strict";const e=window.React,t=window.wp.htmlEntities,n=window.wp.element,o=window.wc.wcBlocksRegistry,c=window.wc.wcSettings,i=e=>{e.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: none;")})},r=window.wc.blocksCheckout;var a=function(e,t,n,o){return new(n||(n=Promise))(function(c,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const s=(e,t,o)=>{const[c,s]=(0,n.useState)("kco"===t),{snippet:l,shippingInIframe:d,countryCodes:u}=e,p=(e=>["#shipping-fields","#billing-fields","#contact-fields",".wc-block-components-checkout-place-order-button",".wp-block-woocommerce-checkout-terms-block",e?"#shipping-option":""])(d),h=l.match(/<script.*?>([\s\S]*?)<\/script>/),m=h?h[1]:"",g=l.replace(/<script.*<\/script>/,""),f=(e=!0)=>{window._klarnaCheckout(function(t){t.suspend({autoResume:e})})};return(0,n.useEffect)(()=>{if(c&&g){const e=(e=>{const t=document.createElement("div");t.setAttribute("srcdoc",e),t.setAttribute("style","width: 100%; height: 100%; border: none;");const n=document.createElement("div");n.className="wc-block-checkout__klarna-checkout wc-block-components-klarna-checkout-block",n.innerHTML=e;const o=document.querySelector(".wc-block-checkout__payment-method");return o&&o.after(n),n})(g),t=document.createElement("script");return t.textContent=m,document.body.appendChild(t),()=>{(e=>{e.remove()})(e),p.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: block;")}),document.body.removeChild(t)}}},[g]),(0,n.useEffect)(()=>{c&&g&&"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({change:function(e){console.log("Change event",e)},load:function(e){console.log("Klarna Checkout loaded",e),i(p)},user_interacted:function(e){console.log("User interacted",e)},customer:function(e){console.log("Customer data",e)},billing_address_change:function(e){console.log("Billing address changed",e)},shipping_address_change:function(e){var t;console.log("Shipping address changed",e),t=e,a(void 0,void 0,void 0,function*(){f();const e=(e=>Object.keys(u).find(t=>u[t]===e.toUpperCase())||"")(t.country);return t.country=e,(0,r.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_address_changed"},t)}).then(e=>{}).catch(e=>{}).finally(()=>{})})},shipping_option_change:function(e){var t;console.log("Shipping option changed",e),t=e,a(void 0,void 0,void 0,function*(){return f(),(0,r.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_option_changed"},t)}).then(e=>{}).catch(e=>{}).finally(()=>{})})},shipping_address_update_error:function(e){console.log("Shipping address update error",e)},order_total_change:function(e){console.log("Order total changed",e)},checkbox_change:function(e){console.log("Checkbox changed",e)},can_not_complete_order:function(e){console.log("Can not complete order",e)},network_error:function(e){console.log("Network error",e)},load_confirmation:function(e){console.log("Load confirmation",e)},redirect_initiated:function(e){console.log("Redirect initiated",e)}})})},[o]),c&&i(p),{isActive:c,elementsToHide:p,suspendKCO:f,resumeKCO:()=>{window._klarnaCheckout(function(e){e.resume()})}}},l=(0,c.getSetting)("kco_data",{}),d=(0,t.decodeEntities)(l.title||"Kustom Checkout"),u=(0,t.decodeEntities)(l.description||""),p=(0,t.decodeEntities)(l.iconUrl||""),h=l.features||[],m=t=>{const{activePaymentMethod:o,billing:c,cartData:i}=t,{isActive:r,suspendKCO:a,resumeKCO:d}=s(l,o,i);return(0,n.useEffect)(()=>{r&&(a(),d())},[c.cartTotalItems]),""!==u?e.createElement("div",{className:"wc-block-components-klarna-checkout"},e.createElement("p",null,u)):null},g={name:"kco",label:e.createElement(()=>e.createElement("div",{style:{display:"flex",gap:16,width:"100%",justifyContent:"space-between",paddingRight:16}},e.createElement("span",null,d),e.createElement("img",{src:p,alt:d})),null),content:e.createElement(m,null),edit:e.createElement(m,null),placeOrderButtonLabel:"Pay with Kustom Checkout",canMakePayment:()=>(!l.error&&l.snippet||console.error("Failed to initialize Kustom Checkout: "+l.error),!0),ariaLabel:d,supports:h};(0,o.registerPaymentMethod)(g)})();