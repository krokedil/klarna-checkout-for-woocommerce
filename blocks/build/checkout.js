(()=>{"use strict";const e=window.React,t=window.wp.htmlEntities,n=window.wp.element,c=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,a=window.wc.blocksCheckout;var i=function(e,t,n,c){return new(n||(n=Promise))(function(o,a){function i(e){try{s(c.next(e))}catch(e){a(e)}}function r(e){try{s(c.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,r)}s((c=c.apply(e,t||[])).next())})};const r=(0,o.getSetting)("kco_data",{}),s=(0,t.decodeEntities)(r.title||"Kustom Checkout"),l=(0,t.decodeEntities)(r.description||""),u=(0,t.decodeEntities)(r.iconUrl||""),d=r.features||[],p=t=>{const{activePaymentMethod:c,billing:o,cartData:s}=t,{isActive:u,suspendKCO:d,resumeKCO:p}=((e,t)=>{const[c,o]=(0,n.useState)("kco"===t),[r,s]=(0,n.useState)(null),[l,u]=(0,n.useState)(null),{snippet:d,shippingInIframe:p,countryCodes:h}=e,k=(e=>["#shipping-fields","#billing-fields","#contact-fields",".wc-block-components-checkout-place-order-button",".wp-block-woocommerce-checkout-terms-block",e?"#shipping-option":""])(p),m=(0,n.useCallback)(()=>{const e=d.match(/<script.*?>([\s\S]*?)<\/script>/),t=e?e[1]:"";return{htmlContentText:d.replace(/<script.*<\/script>/,""),scriptContentText:t}},[d]),w=(0,n.useCallback)((e=!0)=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(t){t.suspend({autoResume:e})})},[]),f=(0,n.useCallback)(()=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.resume()})},[]),b=(0,n.useCallback)(e=>Object.keys(h).find(t=>h[t]===e.toUpperCase())||"",[h]),_=(0,n.useCallback)(e=>i(void 0,void 0,void 0,function*(){w();const t=b(e.country);return e.country=t,(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_address_changed"},e)}).then(()=>{}).catch(e=>{}).finally(()=>{})}),[b,w]),C=(0,n.useCallback)(e=>i(void 0,void 0,void 0,function*(){return w(),(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_option_changed"},e)}).then(e=>{}).catch(e=>{}).finally(()=>{})}),[w]);(0,n.useEffect)(()=>{const{htmlContentText:e,scriptContentText:t}=m();s(e),u(t)},[d,m]);const g=(0,n.useCallback)(()=>{"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({load:e=>{},shipping_address_change:_,shipping_option_change:C,change:e=>{},user_interacted:e=>{},customer:e=>{},billing_address_change:e=>{},shipping_address_update_error:e=>{},order_total_change:e=>{},checkbox_change:e=>{},can_not_complete_order:e=>{},network_error:e=>{},load_confirmation:e=>{},redirect_initiated:e=>{}})})},[_,C]);return(0,n.useEffect)(()=>{if(c&&r){k.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: none;")});const e=(e=>{const t=document.createElement("div");t.id="kco-wrapper",t.className="wc-block-checkout__klarna-checkout wc-block-components-klarna-checkout-block",t.innerHTML=e;const n=document.querySelector(".wc-block-checkout__payment-method");return n&&n.after(t),t})(r),t=document.createElement("script");return t.textContent=l,document.body.appendChild(t),g(),()=>{(e=>{e.remove()})(e),k.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: block;")}),document.body.removeChild(t)}}},[c,r,l,k,g]),{isActive:c,elementsToHide:k,suspendKCO:w,resumeKCO:f}})(r,c);return(0,n.useEffect)(()=>{u&&(d(),p())},[o.cartTotalItems,u,p,d]),""===l?null:e.createElement("div",{className:"wc-block-components-klarna-checkout"},e.createElement("p",null,l))},h={name:"kco",label:e.createElement(()=>e.createElement("div",{style:{display:"flex",gap:16,width:"100%",justifyContent:"space-between",paddingRight:16}},e.createElement("span",null,s),e.createElement("img",{src:u,alt:s})),null),content:e.createElement(p,null),edit:e.createElement(p,null),placeOrderButtonLabel:"Pay with Kustom Checkout",canMakePayment:()=>(!r.error&&r.snippet||console.error("Failed to initialize Kustom Checkout: "+r.error),!0),ariaLabel:s,supports:d};(0,c.registerPaymentMethod)(h)})();