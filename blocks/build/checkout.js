(()=>{"use strict";const e=window.React,t=window.wp.htmlEntities,n=window.wp.element,c=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,i=e=>{e.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: none;")})},a=window.wc.blocksCheckout;var r=function(e,t,n,c){return new(n||(n=Promise))(function(o,i){function a(e){try{s(c.next(e))}catch(e){i(e)}}function r(e){try{s(c.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,r)}s((c=c.apply(e,t||[])).next())})};const s=(0,o.getSetting)("kco_data",{}),l=(0,t.decodeEntities)(s.title||"Kustom Checkout"),d=(0,t.decodeEntities)(s.description||""),u=(0,t.decodeEntities)(s.iconUrl||""),p=s.features||[],m=t=>{const{activePaymentMethod:c,billing:o,cartData:l}=t,{isActive:u,suspendKCO:p,resumeKCO:m}=((e,t,c)=>{const[o,s]=(0,n.useState)("kco"===t),{snippet:l,shippingInIframe:d,countryCodes:u}=e,p=(e=>["#shipping-fields","#billing-fields","#contact-fields",".wc-block-components-checkout-place-order-button",".wp-block-woocommerce-checkout-terms-block",e?"#shipping-option":""])(d),m=l.match(/<script.*?>([\s\S]*?)<\/script>/),h=m?m[1]:"",k=l.replace(/<script.*<\/script>/,""),w=(e=!0)=>{window._klarnaCheckout(function(t){t.suspend({autoResume:e})})},f=e=>r(void 0,void 0,void 0,function*(){w();const t=(e=>Object.keys(u).find(t=>u[t]===e.toUpperCase())||"")(e.country);return e.country=t,(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_address_changed"},e)}).then(e=>{}).catch(e=>{}).finally(()=>{})}),_=e=>r(void 0,void 0,void 0,function*(){return w(),(0,a.extensionCartUpdate)({namespace:"kco-block",data:Object.assign({action:"shipping_option_changed"},e)}).then(e=>{}).catch(e=>{}).finally(()=>{})});return(0,n.useEffect)(()=>{if(o&&k){const e=(e=>{const t=document.createElement("div");t.className="wc-block-checkout__klarna-checkout wc-block-components-klarna-checkout-block",t.innerHTML=e;const n=document.querySelector(".wc-block-checkout__payment-method");return n&&n.after(t),t})(k),t=document.createElement("script");return t.textContent=h,document.body.appendChild(t),()=>{(e=>{e.remove()})(e),p.forEach(e=>{if(""===e)return;const t=document.querySelector(e);t&&t.setAttribute("style","display: block;")}),document.body.removeChild(t)}}},[k]),(0,n.useEffect)(()=>{o&&k&&"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({load:e=>{i(p)},shipping_address_change:f,shipping_option_change:_,change:e=>{},user_interacted:e=>{},customer:e=>{},billing_address_change:e=>{},shipping_address_update_error:e=>{},order_total_change:e=>{},checkbox_change:e=>{},can_not_complete_order:e=>{},network_error:e=>{},load_confirmation:e=>{},redirect_initiated:e=>{}})})},[c]),o&&i(p),{isActive:o,elementsToHide:p,suspendKCO:w,resumeKCO:()=>{window._klarnaCheckout(function(e){e.resume()})}}})(s,c,l);return(0,n.useEffect)(()=>{u&&(p(),m())},[o.cartTotalItems]),""===d?null:e.createElement("div",{className:"wc-block-components-klarna-checkout"},e.createElement("p",null,d))},h={name:"kco",label:e.createElement(()=>e.createElement("div",{style:{display:"flex",gap:16,width:"100%",justifyContent:"space-between",paddingRight:16}},e.createElement("span",null,l),e.createElement("img",{src:u,alt:l})),null),content:e.createElement(m,null),edit:e.createElement(m,null),placeOrderButtonLabel:"Pay with Kustom Checkout",canMakePayment:()=>(!s.error&&s.snippet||console.error("Failed to initialize Kustom Checkout: "+s.error),!0),ariaLabel:l,supports:p};(0,c.registerPaymentMethod)(h)})();