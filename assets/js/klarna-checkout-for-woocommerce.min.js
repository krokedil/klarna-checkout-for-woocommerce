<<<<<<< HEAD
jQuery(function(s){if("undefined"==typeof kco_params)return!1;var i={bodyEl:s("body"),checkoutFormSelector:"form.checkout",orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:s("textarea#order_comments"),extraFieldsValues:{},extraFieldsSelectorText:'div#kco-extra-fields input[type="text"], div#kco-extra-fields input[type="password"], div#kco-extra-fields textarea, div#kco-extra-fields input[type="email"], div#kco-extra-fields input[type="tel"]',extraFieldsSelectorNonText:'div#kco-extra-fields select, div#kco-extra-fields input[type="radio"], div#kco-extra-fields input[type="checkbox"], div#kco-extra-fields input.checkout-date-picker, input#terms input[type="checkbox"]',paymentMethodEl:s('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#klarna-checkout-select-other",formFields:[],documentReady:function(){i.log(kco_params),i.setFormData(),0<i.paymentMethodEl.length?i.paymentMethod=i.paymentMethodEl.filter(":checked").val():i.paymentMethod="",i.confirmLoading()},kcoSuspend:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.suspend()})},kcoResume:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.resume()})},confirmLoading:function(){s("#kco-confirm-loading").css("minHeight","300px").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateCart:function(){i.kcoSuspend(),s.ajax({type:"POST",url:kco_params.update_cart_url,data:{checkout:s("form.checkout").serialize(),nonce:kco_params.update_cart_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){s("body").trigger("update_checkout"),i.kcoResume()}})},updateExtraFields:function(){var e=s(this).attr("name");if("terms"===e)var o=1===s("input#terms:checked").length?1:"";else o=s(this).val();i.log("value"),i.log(o),i.log("name"),i.log(e),i.log(typeof i.extraFieldsValues),i.log(i.extraFieldsValues),null===i.extraFieldsValues&&""===o||null!==i.extraFieldsValues&&e in i.extraFieldsValues&&o===i.extraFieldsValues||(null===i.extraFieldsValues&&(i.extraFieldsValues={}),i.log("update"),i.extraFieldsValues[e]=o,s.ajax({type:"POST",url:kco_params.update_extra_fields_url,data:{extra_fields_values:i.extraFieldsValues,nonce:kco_params.update_extra_fields_nonce},success:function(e){},error:function(e){},complete:function(e){i.log("complete",e)}}))},updateOrderNotes:function(){i.orderNotesEl.val()!==i.orderNotesValue&&(i.orderNotesValue=i.orderNotesEl.val(),s.ajax({type:"POST",url:kco_params.update_order_notes_url,data:{order_notes:i.orderNotesValue,nonce:kco_params.update_order_notes_nonce},success:function(e){},error:function(e){},complete:function(e){i.log("complete",e)}}))},updateKlarnaOrder:function(){"kco"===i.paymentMethod&&"no"===kco_params.is_confirmation_page&&(s(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",url:kco_params.update_klarna_order_url,data:{nonce:kco_params.update_klarna_order_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){!0===e.responseJSON.success?(i.kcoResume(),s(".woocommerce-checkout-review-order-table").unblock()):""!==e.responseJSON.data.redirect_url&&(console.log("Updated Klarna order failed. Reloading checkout or redirecting to cart."),window.location.href=e.responseJSON.data.redirect_url)}}))},changeFromKco:function(e){e.preventDefault(),s(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",dataType:"json",data:{kco:!1,nonce:kco_params.change_payment_method_nonce},url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){i.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})},maybeChangeToKco:function(){i.log(s(this).val()),"kco"===s(this).val()&&(s(".woocommerce-info").remove(),s(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",data:{kco:!0,nonce:kco_params.change_payment_method_nonce},dataType:"json",url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){i.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}}))},checkoutError:function(){if("kco"===i.paymentMethod&&"yes"===kco_params.is_confirmation_page){var e=s(".woocommerce-NoticeGroup-checkout").text();s.ajax({type:"POST",dataType:"json",data:{kco:!1,error_message:e,nonce:kco_params.checkout_error_nonce},url:kco_params.checkout_error_url,success:function(e){},error:function(e){},complete:function(e){i.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})}},log:function(e){kco_params.logging&&console.log(e)},setFormData:function(){var e,o=s('form[name="checkout"] input'),t=[];for(e=0;e<o.length;e++)if(""!==o[e].name){var a=o[e].name,n=s('*[name="'+a+'"]'),r=n.attr("id"),c=!!s('label[for="'+r+'"]').has("abbr").length||"terms"===r;if("-1"==jQuery.inArray(a,kco_params.standard_woo_checkout_fields)&&!0===c){var l=n.is(":checkbox")?n.is(":checked")?o[e].value:"":o[e].value;"terms"===o[e].name&&(l=1===s("input#terms:checked").length?1:""),t.push({name:o[e].name,value:l,required:!0})}}i.formFields=t,i.saveFormData()},saveFormData:function(){s.ajax({type:"POST",url:kco_params.save_form_data,data:{form:i.formFields,nonce:kco_params.save_form_data_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){}})},setFieldValues:function(e){s("#billing_email").val(e.email),s("#billing_state").val(e.states.billing_state),s("#shipping_state").val(e.states.shipping_state),s("#billing_email").change(),s("#billing_email").blur()},init:function(){s(document).ready(i.documentReady),i.bodyEl.on("update_checkout",i.kcoSuspend),i.bodyEl.on("updated_checkout",i.updateKlarnaOrder),i.bodyEl.on("checkout_error",i.checkoutError),i.bodyEl.on("change","input.qty",i.updateCart),i.bodyEl.on("blur",i.extraFieldsSelectorText,i.setFormData),i.bodyEl.on("change",i.extraFieldsSelectorNonText,i.setFormData),i.bodyEl.on("blur",i.extraFieldsSelectorText,i.updateExtraFields),i.bodyEl.on("change",i.extraFieldsSelectorNonText,i.updateExtraFields),i.bodyEl.on("change",'input[name="payment_method"]',i.maybeChangeToKco),i.bodyEl.on("click",i.selectAnotherSelector,i.changeFromKco),i.bodyEl.on("click","input#terms",i.setFormData),i.bodyEl.on("click","input#terms",i.updateExtraFields),"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({shipping_address_change:function(e){i.log("shipping_address_change"),i.log(e),s(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),i.kcoSuspend(),s.ajax({url:kco_params.iframe_shipping_address_change_url,type:"POST",dataType:"json",data:{data:e,nonce:kco_params.iframe_shipping_address_change_nonce},success:function(e){i.log(e)},error:function(e){i.log(e)},complete:function(e){!0===e.responseJSON.success?(i.setFieldValues(e.responseJSON.data),s("body").trigger("update_checkout"),s(".woocommerce-checkout-review-order-table").unblock(),i.kcoResume()):""!==e.responseJSON.data.redirect_url&&(console.log("Shipping address change update failed. Redirecting to cart."),window.location.href=e.responseJSON.data.redirect_url)}})},change:function(e){i.log("change",e)},order_total_change:function(e){i.log("order_total_change",e)},shipping_option_change:function(e){i.log("shipping_option_change",e)},can_not_complete_order:function(e){i.log("can_not_complete_order",e)}})})}};i.init(),s("body").on("blur",i.setFormData),s(document).on("keypress","#kco-order-review .qty",function(e){13==e.keyCode&&e.preventDefault()})});
=======
jQuery(function(s){if("undefined"==typeof kco_params)return!1;var l={bodyEl:s("body"),checkoutFormSelector:"form.checkout",orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:s("textarea#order_comments"),extraFieldsValues:{},extraFieldsSelectorText:'div#kco-extra-fields input[type="text"], div#kco-extra-fields input[type="password"], div#kco-extra-fields textarea, div#kco-extra-fields input[type="email"], div#kco-extra-fields input[type="tel"]',extraFieldsSelectorNonText:'div#kco-extra-fields select, div#kco-extra-fields input[type="radio"], div#kco-extra-fields input[type="checkbox"], div#kco-extra-fields input.checkout-date-picker, input#terms input[type="checkbox"]',paymentMethodEl:s('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#klarna-checkout-select-other",formFields:[],documentReady:function(){l.log(kco_params),l.setFormData(),0<l.paymentMethodEl.length?l.paymentMethod=l.paymentMethodEl.filter(":checked").val():l.paymentMethod="kco",l.confirmLoading(),l.setFormFieldValuesFromTransiet()},kcoSuspend:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.suspend()})},kcoResume:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.resume()})},confirmLoading:function(){s("#kco-confirm-loading").css("minHeight","300px").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateCart:function(){l.kcoSuspend(),s.ajax({type:"POST",url:kco_params.update_cart_url,data:{checkout:s("form.checkout").serialize(),nonce:kco_params.update_cart_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){s("body").trigger("update_checkout"),l.kcoResume()}})},updateExtraFields:function(){var t=s(this),a=l.formFields,n=t.attr("name"),c=t.val();s.each(a,function(e,o){o.name===n&&(t.is(":checkbox")&&(t.is(":checked")||(c="")),t.is(":radio ")&&(t.is(":checked")||(c="")),"select-one"===t.prop("type")&&(c=t.find(":selected").val()),a[e].value=c)}),l.formFields=a,l.saveFormData()},updateOrderNotes:function(){l.orderNotesEl.val()!==l.orderNotesValue&&(l.orderNotesValue=l.orderNotesEl.val(),s.ajax({type:"POST",url:kco_params.update_order_notes_url,data:{order_notes:l.orderNotesValue,nonce:kco_params.update_order_notes_nonce},success:function(e){},error:function(e){},complete:function(e){l.log("complete",e)}}))},updateKlarnaOrder:function(){"kco"===l.paymentMethod&&"no"===kco_params.is_confirmation_page&&(s(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",url:kco_params.update_klarna_order_url,data:{nonce:kco_params.update_klarna_order_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){!0===e.responseJSON.success?(l.kcoResume(),s(".woocommerce-checkout-review-order-table").unblock()):""!==e.responseJSON.data.redirect_url&&(console.log("Cart do not need payment. Reloading checkout."),window.location.href=e.responseJSON.data.redirect_url)}}))},changeFromKco:function(e){e.preventDefault(),s(l.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",dataType:"json",data:{kco:!1,nonce:kco_params.change_payment_method_nonce},url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){l.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})},maybeChangeToKco:function(){l.log(s(this).val()),"kco"===s(this).val()&&(s(".woocommerce-info").remove(),s(l.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",data:{kco:!0,nonce:kco_params.change_payment_method_nonce},dataType:"json",url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){l.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}}))},checkoutError:function(){if("kco"===l.paymentMethod&&"yes"===kco_params.is_confirmation_page){var e=s(".woocommerce-NoticeGroup-checkout").text();s.ajax({type:"POST",dataType:"json",data:{kco:!1,error_message:e,nonce:kco_params.checkout_error_nonce},url:kco_params.checkout_error_url,success:function(e){},error:function(e){},complete:function(e){l.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})}},log:function(e){kco_params.logging&&console.log(e)},setFormData:function(){var e,o=s('form[name="checkout"] input, form[name="checkout"] select'),t=[];for(e=0;e<o.length;e++)if(""!==o[e].name){var a=o[e].name,n=s('*[name="'+a+'"]'),c=!!n.parents("p.form-row").hasClass("validate-required");if("-1"==s.inArray(a,kco_params.standard_woo_checkout_fields)&&a.indexOf("[qty]")<0){var r=!1,i=n.is(":checkbox")?n.is(":checked")?o[e].value:"":o[e].value;!0===c&&("terms"===o[e].name&&(i=1===s("input#terms:checked").length?1:""),r=!0),t.find(function(e){return!(!e.name||e.name!==a)})||t.push({name:o[e].name,value:i,required:r})}}l.formFields=t,l.saveFormData()},saveFormData:function(){s.ajax({type:"POST",url:kco_params.save_form_data,data:{form:l.formFields,nonce:kco_params.save_form_data_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){}})},setFormFieldValuesFromTransiet:function(){var e=kco_params.form;for(i=0;i<e.length;i++){var o=s('*[name="'+e[i].name+'"]'),t=e[i].value;if(o.is(":checkbox"))""!==t&&o.prop("checked",!0);else if(o.is(":radio"))for(x=0;x<o.length;x++)o[x].value===e[i].value&&s(o[x]).prop("checked",!0);else o.val(t)}},setFieldValues:function(e){s("#billing_email").val(e.email),s("#billing_state").val(e.states.billing_state),s("#shipping_state").val(e.states.shipping_state),s("#billing_email").change(),s("#billing_email").blur()},init:function(){s(document).ready(l.documentReady),l.bodyEl.on("update_checkout",l.kcoSuspend),l.bodyEl.on("updated_checkout",l.updateKlarnaOrder),l.bodyEl.on("checkout_error",l.checkoutError),l.bodyEl.on("change","input.qty",l.updateCart),l.bodyEl.on("blur",l.extraFieldsSelectorText,l.updateExtraFields),l.bodyEl.on("change",l.extraFieldsSelectorNonText,l.updateExtraFields),l.bodyEl.on("change",'input[name="payment_method"]',l.maybeChangeToKco),l.bodyEl.on("click",l.selectAnotherSelector,l.changeFromKco),l.bodyEl.on("click","input#terms",l.setFormData),l.bodyEl.on("click","input#terms",l.updateExtraFields),"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({shipping_address_change:function(e){l.log("shipping_address_change"),l.log(e),s(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),l.kcoSuspend(),s.ajax({url:kco_params.iframe_shipping_address_change_url,type:"POST",dataType:"json",data:{data:e,nonce:kco_params.iframe_shipping_address_change_nonce},success:function(e){l.log(e),l.setFieldValues(e.data),s("body").trigger("update_checkout")},error:function(e){l.log(e)},complete:function(){s(".woocommerce-checkout-review-order-table").unblock(),l.kcoResume()}})},change:function(e){l.log("change",e)},order_total_change:function(e){l.log("order_total_change",e)},shipping_option_change:function(e){l.log("shipping_option_change",e)},can_not_complete_order:function(e){l.log("can_not_complete_order",e)}})})}};l.init(),s("body").on("blur",l.setFormData),s(document).on("keypress","#kco-order-review .qty",function(e){13==e.keyCode&&e.preventDefault()})});
>>>>>>> develop-remove-transient
